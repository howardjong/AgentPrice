
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemini Code Assistant</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    body {
      padding-top: 2rem;
      background-color: #f8f9fa;
    }
    .code-input {
      font-family: monospace;
      min-height: 300px;
    }
    .output {
      font-family: system-ui, -apple-system, sans-serif;
      min-height: 300px;
      background-color: white;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 1rem 0;
    }
    .spinner-border {
      width: 3rem;
      height: 3rem;
    }
    .nav-tabs {
      margin-bottom: 15px;
    }
    .btn-action {
      margin-bottom: 10px;
    }
    .instructions-input {
      margin-bottom: 10px;
    }
    .mode-badge {
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Gemini Code Assistant</h1>
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="review-tab" data-bs-toggle="tab" data-bs-target="#review" type="button" role="tab" aria-controls="review" aria-selected="true">Code Review</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="refactor-tab" data-bs-toggle="tab" data-bs-target="#refactor" type="button" role="tab" aria-controls="refactor" aria-selected="false">Code Refactoring</button>
      </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
      <!-- Code Review Tab -->
      <div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">Your Code</h5>
              </div>
              <div class="card-body">
                <textarea id="reviewCodeInput" class="form-control code-input" placeholder="Paste your code here..."></textarea>
                <div class="mt-3">
                  <button id="reviewBtn" class="btn btn-primary">
                    <i class="bi bi-search"></i> Review Code
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Code Review</h5>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="reviewModelSwitch">
                  <label class="form-check-label" for="reviewModelSwitch">Use Pro Model</label>
                </div>
              </div>
              <div class="card-body">
                <div id="reviewOutput" class="output">Review will appear here...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Code Refactoring Tab -->
      <div class="tab-pane fade" id="refactor" role="tabpanel" aria-labelledby="refactor-tab">
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">Your Code</h5>
              </div>
              <div class="card-body">
                <textarea id="refactorCodeInput" class="form-control code-input" placeholder="Paste your code here..."></textarea>
                <div class="mt-3">
                  <textarea id="refactorInstructions" class="form-control instructions-input" placeholder="Specific refactoring instructions (optional)..."></textarea>
                  <button id="refactorBtn" class="btn btn-success">
                    <i class="bi bi-lightning-charge"></i> Refactor Code
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Refactored Code</h5>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="refactorModelSwitch">
                  <label class="form-check-label" for="refactorModelSwitch">Use Pro Model</label>
                </div>
              </div>
              <div class="card-body">
                <div id="refactorOutput" class="output">Refactored code will appear here...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="loading" id="loadingIndicator">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Processing your request... This may take a moment.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM elements
      const reviewBtn = document.getElementById('reviewBtn');
      const refactorBtn = document.getElementById('refactorBtn');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const reviewCodeInput = document.getElementById('reviewCodeInput');
      const refactorCodeInput = document.getElementById('refactorCodeInput');
      const refactorInstructions = document.getElementById('refactorInstructions');
      const reviewOutput = document.getElementById('reviewOutput');
      const refactorOutput = document.getElementById('refactorOutput');
      const reviewModelSwitch = document.getElementById('reviewModelSwitch');
      const refactorModelSwitch = document.getElementById('refactorModelSwitch');
      
      // Review code
      reviewBtn.addEventListener('click', async function() {
        const code = reviewCodeInput.value.trim();
        
        if (!code) {
          alert('Please enter code to review.');
          return;
        }
        
        loadingIndicator.style.display = 'block';
        reviewOutput.textContent = 'Analyzing code...';
        
        try {
          const model = reviewModelSwitch.checked ? 'gemini-1.5-pro' : 'gemini-1.5-flash';
          
          const response = await fetch('/api/review', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ code, model }),
          });
          
          const data = await response.json();
          
          if (response.ok) {
            reviewOutput.innerHTML = formatOutput(data.text);
          } else {
            reviewOutput.textContent = `Error: ${data.error}`;
          }
        } catch (error) {
          reviewOutput.textContent = `Error: ${error.message}`;
        } finally {
          loadingIndicator.style.display = 'none';
        }
      });
      
      // Refactor code
      refactorBtn.addEventListener('click', async function() {
        const code = refactorCodeInput.value.trim();
        const instructions = refactorInstructions.value.trim();
        
        if (!code) {
          alert('Please enter code to refactor.');
          return;
        }
        
        loadingIndicator.style.display = 'block';
        refactorOutput.textContent = 'Refactoring code...';
        
        try {
          const model = refactorModelSwitch.checked ? 'gemini-1.5-pro' : 'gemini-1.5-flash';
          
          const response = await fetch('/api/refactor', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ code, instructions, model }),
          });
          
          const data = await response.json();
          
          if (response.ok) {
            refactorOutput.innerHTML = formatOutput(data.text);
          } else {
            refactorOutput.textContent = `Error: ${data.error}`;
          }
        } catch (error) {
          refactorOutput.textContent = `Error: ${error.message}`;
        } finally {
          loadingIndicator.style.display = 'none';
        }
      });
      
      // Format output with syntax highlighting
      function formatOutput(text) {
        // Simple markdown-like formatting
        return text
          .replace(/\n\n/g, '<br><br>')
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/```([a-z]*)\n([\s\S]*?)\n```/g, function(match, language, code) {
            return `<div class="bg-light p-3 my-2 rounded"><pre class="mb-0"><code>${escapeHtml(code)}</code></pre></div>`;
          })
          .replace(/`(.*?)`/g, '<code class="bg-light px-1 rounded">$1</code>')
          .replace(/^# (.*?)$/gm, '<h3>$1</h3>')
          .replace(/^## (.*?)$/gm, '<h4>$1</h4>')
          .replace(/^### (.*?)$/gm, '<h5>$1</h5>');
      }
      
      // Helper function to escape HTML
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
      
      // Sync code between tabs
      document.querySelectorAll('.nav-link').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function() {
          if (this.id === 'refactor-tab') {
            refactorCodeInput.value = reviewCodeInput.value;
          } else {
            reviewCodeInput.value = refactorCodeInput.value;
          }
        });
      });
    });
  </script>
</body>
</html>
